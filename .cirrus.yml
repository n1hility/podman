win_installer_task:
    name: "Verify Win Installer Build"
    depends_on:
    windows_container:
        image: cirrusci/windowsservercore:2019
    env:
        CIRRUS_SHELL: powershell
        CIRRUS_CLONE_DEPTH: 1
        WIN_INSTALLER_SRC_RELEASE: 4.2.0
#        CIRRUS_WORKING_DIR: "${CIRRUS_DEFAULT_WORK}"
    install_script: |
        choco install -y wixtoolset `
                         mingw `
                         golang `
                         dotnet-sdk `
                         archiver `
                         curl
        Exit $LASTEXITCODE
    main_script: |
        function CheckExit() {
            if ($LASTEXITCODE -ne 0) {
                Exit 1
            } 
        }
        # $ENV:ARTCURL/Windows%20Cross/repo/repo.tbz; CheckExit
        Set-Location contrib\win-installer
        .\build.ps1 $ENV:WIN_INSTALLER_SRC_RELEASE; CheckExit
